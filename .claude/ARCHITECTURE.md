# ç³»ç»Ÿæ¶æ„è¯¦è§£

## ğŸ—ï¸ æ¶æ„æ¦‚è§ˆ

è¿™æ˜¯ä¸€ä¸ªåŸºäº Claude Code çš„è‡ªåŠ¨åŒ–å¤šä»£ç†åä½œç³»ç»Ÿï¼Œå®ç°äº†å®Œå…¨è‡ªä¸»çš„å¼€å‘å·¥ä½œæµã€‚

## ä¸‰å±‚æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Layer 1: å¤–éƒ¨ç¼–æ’å±‚                        â”‚
â”‚                      ï¼ˆå¯é€‰çš„ï¼‰                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Headless Scripts / CI/CD                           â”‚    â”‚
â”‚  â”‚  - æ‰¹é‡ä»»åŠ¡æ‰§è¡Œ                                       â”‚    â”‚
â”‚  â”‚  - GitHub Actions é›†æˆ                               â”‚    â”‚
â”‚  â”‚  - è‡ªåŠ¨åŒ–æµ‹è¯•æµæ°´çº¿                                   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Layer 2: Claude Code ä¸»å®ä¾‹ + Hooks             â”‚
â”‚                   ï¼ˆDM - Development Managerï¼‰               â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  ä¸» Claude å®ä¾‹                                        â”‚   â”‚
â”‚  â”‚  - ç†è§£ç”¨æˆ·éœ€æ±‚                                        â”‚   â”‚
â”‚  â”‚  - åè°ƒå­ä»£ç†                                          â”‚   â”‚
â”‚  â”‚  - ä¼ é€’ä¸Šä¸‹æ–‡                                          â”‚   â”‚
â”‚  â”‚  - åšå‡ºé«˜å±‚å†³ç­–                                        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                            â†•                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Hooks (è‡ªåŠ¨åŒ–æ§åˆ¶å±‚)                                  â”‚   â”‚
â”‚  â”‚                                                        â”‚   â”‚
â”‚  â”‚  SubagentStop Hook (workflow_dm.py)                   â”‚   â”‚
â”‚  â”‚  â€¢ æ£€æµ‹å“ªä¸ªä»£ç†å®Œæˆäº†                                  â”‚   â”‚
â”‚  â”‚  â€¢ åˆ†æå½“å‰çŠ¶æ€                                        â”‚   â”‚
â”‚  â”‚  â€¢ å†³å®šä¸‹ä¸€æ­¥è¡ŒåŠ¨                                      â”‚   â”‚
â”‚  â”‚  â€¢ é€šè¿‡ "block" æœºåˆ¶å¼ºåˆ¶ç»§ç»­                           â”‚   â”‚
â”‚  â”‚                                                        â”‚   â”‚
â”‚  â”‚  PostToolUse Hook (test_checker.py)                   â”‚   â”‚
â”‚  â”‚  â€¢ ç›‘æ§æµ‹è¯•å‘½ä»¤æ‰§è¡Œ                                    â”‚   â”‚
â”‚  â”‚  â€¢ è¯†åˆ«æµ‹è¯•ç»“æœ                                        â”‚   â”‚
â”‚  â”‚  â€¢ æä¾›é¢å¤–åé¦ˆ                                        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                Layer 3: ä¸“é—¨åŒ–çš„ Subagents                    â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Planner  â”‚  â”‚ Developer â”‚  â”‚ Tester â”‚  â”‚ Debugger  â”‚   â”‚
â”‚  â”‚          â”‚  â”‚           â”‚  â”‚        â”‚  â”‚           â”‚   â”‚
â”‚  â”‚ ğŸ“‹ åˆ†æ  â”‚  â”‚ ğŸ’» ç¼–ç    â”‚  â”‚ ğŸ§ª æµ‹è¯•â”‚  â”‚ ğŸ” è°ƒè¯•   â”‚   â”‚
â”‚  â”‚ éœ€æ±‚     â”‚  â”‚ å®ç°      â”‚  â”‚ éªŒè¯   â”‚  â”‚ åˆ†æ      â”‚   â”‚
â”‚  â”‚ è§„åˆ’     â”‚  â”‚ åŠŸèƒ½      â”‚  â”‚ åŠŸèƒ½   â”‚  â”‚ é—®é¢˜      â”‚   â”‚
â”‚  â”‚          â”‚  â”‚           â”‚  â”‚        â”‚  â”‚           â”‚   â”‚
â”‚  â”‚ Tools:   â”‚  â”‚ Tools:    â”‚  â”‚ Tools: â”‚  â”‚ Tools:    â”‚   â”‚
â”‚  â”‚ Read     â”‚  â”‚ Read      â”‚  â”‚ Bash   â”‚  â”‚ Read      â”‚   â”‚
â”‚  â”‚ Grep     â”‚  â”‚ Write     â”‚  â”‚ Read   â”‚  â”‚ Grep      â”‚   â”‚
â”‚  â”‚ Glob     â”‚  â”‚ Edit      â”‚  â”‚ Grep   â”‚  â”‚ Glob      â”‚   â”‚
â”‚  â”‚ Bash     â”‚  â”‚ Grep      â”‚  â”‚ Glob   â”‚  â”‚ Bash      â”‚   â”‚
â”‚  â”‚          â”‚  â”‚ Glob      â”‚  â”‚        â”‚  â”‚           â”‚   â”‚
â”‚  â”‚          â”‚  â”‚ Bash      â”‚  â”‚        â”‚  â”‚           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                              â”‚
â”‚  æ¯ä¸ª Agent:                                                 â”‚
â”‚  â€¢ ç‹¬ç«‹çš„ä¸Šä¸‹æ–‡çª—å£                                          â”‚
â”‚  â€¢ ä¸“é—¨çš„ç³»ç»Ÿæç¤º                                            â”‚
â”‚  â€¢ å—é™çš„å·¥å…·è®¿é—®                                            â”‚
â”‚  â€¢ å¯é…ç½®çš„æ¨¡å‹é€‰æ‹©                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ æ‰§è¡Œæµç¨‹è¯¦è§£

### é˜¶æ®µ 1: å¯åŠ¨

```
ç”¨æˆ·è¾“å…¥ï¼š/auto-dev å†™ä¸€ä¸ªè´ªåƒè›‡æ¸¸æˆ
         â†“
auto-dev.md å‘½ä»¤è¢«è§¦å‘
         â†“
ä¸» Claude å®ä¾‹ï¼ˆDMï¼‰æ¥æ”¶è¯·æ±‚å¹¶å¼€å§‹åè°ƒ
```

### é˜¶æ®µ 2: è§„åˆ’

```
DM è°ƒç”¨ â†’ Planner Agent
              â†“
         åˆ†æéœ€æ±‚
         ç ”ç©¶ä»£ç åº“
         åˆ¶å®šè¯¦ç»†è®¡åˆ’
              â†“
         è¿”å›å®Œæ•´è®¡åˆ’
              â†“
SubagentStop Hook è§¦å‘ â†’ workflow_dm.py
              â†“
         æ£€æµ‹åˆ°: agent_completed = 'planner'
         å†³ç­–: "Use developer agent to implement"
              â†“
         è¿”å› {"decision": "block", "reason": "..."}
              â†“
ä¸»å®ä¾‹è¢«å¼ºåˆ¶ç»§ç»­ â†’ è¿›å…¥é˜¶æ®µ 3
```

### é˜¶æ®µ 3: å®ç°

```
DM è°ƒç”¨ â†’ Developer Agent (ä¼ é€’å®Œæ•´è®¡åˆ’)
              â†“
         è¯»å–ç°æœ‰ä»£ç 
         æŒ‰æ­¥éª¤å®ç°
         åˆ›å»º/ä¿®æ”¹æ–‡ä»¶
              â†“
         è¿”å›å®ç°æŠ¥å‘Š
              â†“
SubagentStop Hook è§¦å‘ â†’ workflow_dm.py
              â†“
         æ£€æµ‹åˆ°: agent_completed = 'developer'
                debug_iterations = 0
         å†³ç­–: "Use tester agent to verify"
              â†“
         è¿”å› {"decision": "block", "reason": "..."}
              â†“
ä¸»å®ä¾‹è¢«å¼ºåˆ¶ç»§ç»­ â†’ è¿›å…¥é˜¶æ®µ 4
```

### é˜¶æ®µ 4: æµ‹è¯•

```
DM è°ƒç”¨ â†’ Tester Agent
              â†“
         æŸ¥æ‰¾æµ‹è¯•å‘½ä»¤
         è¿è¡Œè‡ªåŠ¨åŒ–æµ‹è¯•
         æ‰§è¡Œæ‰‹åŠ¨æµ‹è¯•
              â†“
         åˆ†æç»“æœ â†’ åˆ¤æ–­é€šè¿‡/å¤±è´¥
              â†“
         è¿”å›æµ‹è¯•æŠ¥å‘Š (åŒ…å«çŠ¶æ€æ ‡è®°)
              â†“
PostToolUse Hook è§¦å‘ â†’ test_checker.py (å¦‚æœæœ‰ Bash å‘½ä»¤)
         ç›‘æ§æµ‹è¯•æ‰§è¡Œ
              â†“
SubagentStop Hook è§¦å‘ â†’ workflow_dm.py
              â†“
         æ£€æµ‹åˆ°: agent_completed = 'tester'
                test_status = 'passed' æˆ– 'failed'
              â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
    â†“                 â†“
  PASSED            FAILED
    â†“                 â†“
  å®Œæˆ          è¿›å…¥ Debug Loop
```

### é˜¶æ®µ 5: Debug Loopï¼ˆä»…åœ¨æµ‹è¯•å¤±è´¥æ—¶ï¼‰

```
                Debug Loop (æœ€å¤š 5 æ¬¡è¿­ä»£)
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚                         â”‚
                â†“                         â”‚
DM è°ƒç”¨ â†’ Debugger Agent                  â”‚
              â†“                           â”‚
         åˆ†ææµ‹è¯•å¤±è´¥æŠ¥å‘Š                   â”‚
         å®šä½é—®é¢˜æ ¹æº                       â”‚
         æä¾›ä¿®å¤å»ºè®®                       â”‚
              â†“                           â”‚
         è¿”å›è°ƒè¯•åˆ†æ                       â”‚
              â†“                           â”‚
SubagentStop Hook â†’ workflow_dm.py        â”‚
         å†³ç­–: "Use developer to fix"     â”‚
              â†“                           â”‚
DM è°ƒç”¨ â†’ Developer Agent (ä¼ é€’è°ƒè¯•åˆ†æ)   â”‚
              â†“                           â”‚
         å®ç°ä¿®å¤                           â”‚
              â†“                           â”‚
SubagentStop Hook â†’ workflow_dm.py        â”‚
         å†³ç­–: "Use tester to re-test"    â”‚
              â†“                           â”‚
DM è°ƒç”¨ â†’ Tester Agent                    â”‚
              â†“                           â”‚
         é‡æ–°è¿è¡Œæµ‹è¯•                       â”‚
              â†“                           â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
    â†“                 â†“                  â”‚
  PASSED            FAILED               â”‚
    â†“                 â†“                  â”‚
  å®Œæˆ        iteration < 5? â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â†“
              iteration >= 5
                     â†“
         æŠ¥å‘Š: è¾¾åˆ°æœ€å¤§è¿­ä»£æ¬¡æ•°ï¼Œéœ€è¦äººå·¥å¹²é¢„
                     â†“
                   å®Œæˆ
```

### é˜¶æ®µ 6: å®Œæˆ

```
DM ç”Ÿæˆæœ€ç»ˆæŠ¥å‘Š
    â†“
åŒ…å«ï¼š
â€¢ å®æ–½çš„åŠŸèƒ½
â€¢ åˆ›å»º/ä¿®æ”¹çš„æ–‡ä»¶
â€¢ æµ‹è¯•ç»“æœ
â€¢ è§£å†³çš„é—®é¢˜
â€¢ æœ€ç»ˆçŠ¶æ€ (æˆåŠŸ/éƒ¨åˆ†æˆåŠŸ/éœ€è¦äººå·¥)
```

## ğŸ§  Hook å†³ç­–é€»è¾‘è¯¦è§£

### workflow_dm.py å†³ç­–è¡¨

| è¾“å…¥çŠ¶æ€ | è¾“å‡ºå†³ç­– |
|---------|---------|
| **Agent**: planner<br>**Test**: N/A<br>**Iterations**: N/A | **Block**: âœ…<br>**Next**: "Use developer agent to implement the plan" |
| **Agent**: developer<br>**Test**: N/A<br>**Iterations**: 0 | **Block**: âœ…<br>**Next**: "Use tester agent to verify" |
| **Agent**: developer<br>**Test**: N/A<br>**Iterations**: >0 | **Block**: âœ…<br>**Next**: "Use tester agent to re-test (Iteration N)" |
| **Agent**: tester<br>**Test**: PASSED<br>**Iterations**: any | **Block**: âŒ<br>**Next**: Natural completion |
| **Agent**: tester<br>**Test**: FAILED<br>**Iterations**: <5 | **Block**: âœ…<br>**Next**: "Use debugger agent to analyze failures" |
| **Agent**: tester<br>**Test**: FAILED<br>**Iterations**: â‰¥5 | **Block**: âŒ<br>**Next**: Natural completion (max iterations reached) |
| **Agent**: debugger<br>**Test**: N/A<br>**Iterations**: any | **Block**: âœ…<br>**Next**: "Use developer agent to implement fixes" |

### çŠ¶æ€æ£€æµ‹æ–¹æ³•

**Agent ç±»å‹æ£€æµ‹:**
```python
# 1. æŸ¥æ‰¾ subagent_type å‚æ•°
if '"planner"' in transcript:
    return 'planner'

# 2. æŸ¥æ‰¾è§’è‰²ç‰¹å®šçš„è¾“å‡ºæ¨¡å¼
if 'implementation plan:' in transcript:
    return 'planner'
if 'implementation complete' in transcript:
    return 'developer'
if 'test results:' in transcript:
    return 'tester'
```

**æµ‹è¯•çŠ¶æ€æ£€æµ‹:**
```python
# æŸ¥æ‰¾æ˜ç¡®çš„çŠ¶æ€æ ‡è®°
if 'test results: passed' in transcript:
    return 'passed'
if 'test results: failed' in transcript:
    return 'failed'

# æŸ¥æ‰¾ç¬¦å·æ ‡è®°
if re.search(r'passed:?\s*âœ…', transcript) and 'failed: 0' in transcript:
    return 'passed'
```

**è¿­ä»£è®¡æ•°:**
```python
# ç»Ÿè®¡ debugger ä½¿ç”¨æ¬¡æ•°
debugger_uses = len(re.findall(r'use the debugger', transcript))
return debugger_uses
```

## ğŸ”Œ ç»„ä»¶äº¤äº’å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ç”¨æˆ·äº¤äº’                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â†“
              /auto-dev [éœ€æ±‚]
                      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           auto-dev.md (Slash Command)              â”‚
â”‚  â€¢ å®šä¹‰å®Œæ•´å·¥ä½œæµç¨‹                                  â”‚
â”‚  â€¢ æä¾›è¯¦ç»†æŒ‡ä»¤ç»™ DM                                 â”‚
â”‚  â€¢ æŒ‡å®šå„é˜¶æ®µçš„ agent è°ƒç”¨                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          ä¸» Claude å®ä¾‹ (DM è§’è‰²)                   â”‚
â”‚                                                     â”‚
â”‚  åè°ƒå¾ªç¯:                                          â”‚
â”‚  1. ç†è§£å½“å‰é˜¶æ®µ                                     â”‚
â”‚  2. é€‰æ‹©åˆé€‚çš„ agent                                â”‚
â”‚  3. å‡†å¤‡å®Œæ•´ä¸Šä¸‹æ–‡                                   â”‚
â”‚  4. è°ƒç”¨ Task å·¥å…·                                  â”‚
â”‚  5. ç­‰å¾… agent å®Œæˆ                                 â”‚
â”‚  6. æ¥æ”¶ç»“æœ                                        â”‚
â”‚  7. (Hook ä»‹å…¥å†³å®šä¸‹ä¸€æ­¥)                           â”‚
â”‚  8. å¾ªç¯...                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“                                  â†‘
         â†“                                  â†‘
    Task Tool                         Hook Decision
         â†“                                  â†‘
         â†“                                  â†‘
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Subagent éš”ç¦»å±‚                     â”‚
â”‚                                                     â”‚
â”‚  æ¯ä¸ª Subagent:                                     â”‚
â”‚  â€¢ æ¥æ”¶ç‰¹å®šä»»åŠ¡å’Œä¸Šä¸‹æ–‡                              â”‚
â”‚  â€¢ åœ¨ç‹¬ç«‹ä¸Šä¸‹æ–‡çª—å£ä¸­å·¥ä½œ                            â”‚
â”‚  â€¢ ä½¿ç”¨å—é™çš„å·¥å…·é›†                                  â”‚
â”‚  â€¢ è¿”å›ç»“æ„åŒ–ç»“æœ                                    â”‚
â”‚  â€¢ è§¦å‘ SubagentStop äº‹ä»¶                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â†“
         SubagentStop Event è§¦å‘
                      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           workflow_dm.py (Hook Script)              â”‚
â”‚                                                     â”‚
â”‚  æ‰§è¡Œæµç¨‹:                                           â”‚
â”‚  1. è¯»å– hook è¾“å…¥ (JSON from stdin)                â”‚
â”‚  2. è¯»å– transcript æ–‡ä»¶                            â”‚
â”‚  3. æ£€æµ‹ agent ç±»å‹                                 â”‚
â”‚  4. æ£€æµ‹æµ‹è¯•çŠ¶æ€                                     â”‚
â”‚  5. ç»Ÿè®¡è¿­ä»£æ¬¡æ•°                                     â”‚
â”‚  6. åº”ç”¨å†³ç­–é€»è¾‘                                     â”‚
â”‚  7. è¿”å›å†³ç­– (block/continue)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â†“
           {"decision": "block", "reason": "..."}
                      â†“
        å¼ºåˆ¶ä¸»å®ä¾‹ç»§ç»­å·¥ä½œ â†’ å›åˆ° DM åè°ƒå¾ªç¯
```

## ğŸ“¦ æ•°æ®æµ

### 1. ç”¨æˆ·è¯·æ±‚ â†’ DM

```json
{
  "command": "/auto-dev",
  "arguments": "å†™ä¸€ä¸ªè´ªåƒè›‡æ¸¸æˆ"
}
```

### 2. DM â†’ Planner Agent

```
Task Tool è°ƒç”¨:
{
  "subagent_type": "general-purpose",
  "description": "Planning phase",
  "prompt": "Analyze the following feature request and create a detailed implementation plan: å†™ä¸€ä¸ªè´ªåƒè›‡æ¸¸æˆ..."
}
```

### 3. Planner â†’ DM (ç»“æœ)

```markdown
# Implementation Plan: è´ªåƒè›‡æ¸¸æˆ

## 1. Requirements Summary
- æ¸¸æˆç½‘æ ¼å’Œè›‡çš„æ˜¾ç¤º
- é”®ç›˜æ§åˆ¶
- é£Ÿç‰©ç”Ÿæˆå’Œå¾—åˆ†
...

## 2. Codebase Analysis
...

## 3. Technical Approach
...
```

### 4. Hook æ¥æ”¶çš„æ•°æ®

```json
{
  "event": "SubagentStop",
  "tool_name": "Task",
  "subagent_type": "general-purpose",
  "transcript_path": "/path/to/transcript.txt",
  "tool_result": "..."
}
```

### 5. Hook è¿”å›çš„å†³ç­–

```json
{
  "decision": "block",
  "reason": "Use the **developer** agent to implement the plan created by the planner. Pass the complete implementation plan to the developer."
}
```

### 6. DM â†’ Developer Agent

```
Task Tool è°ƒç”¨:
{
  "subagent_type": "general-purpose",
  "description": "Development phase",
  "prompt": "Implement the following plan: [å®Œæ•´çš„ Planner è¾“å‡º]..."
}
```

...å¾ªç¯ç»§ç»­...

## ğŸ›ï¸ é…ç½®æµç¨‹

### settings.json é…ç½®

```json
{
  "hooks": {
    "SubagentStop": [                    â† äº‹ä»¶ç±»å‹
      {
        "description": "...",            â† å¯è¯»æè¿°
        "hooks": [                       â† Hook åˆ—è¡¨
          {
            "type": "command",           â† Hook ç±»å‹
            "command": "python ...",     â† æ‰§è¡Œçš„å‘½ä»¤
            "timeout": 5000              â† è¶…æ—¶ï¼ˆæ¯«ç§’ï¼‰
          }
        ]
      }
    ]
  }
}
```

### Agent é…ç½®ç»“æ„

```markdown
---
name: agent-name              â† Agent æ ‡è¯†ç¬¦
description: Brief desc       â† ä½•æ—¶ä½¿ç”¨è¿™ä¸ª agent
tools: Tool1, Tool2          â† å…è®¸çš„å·¥å…·åˆ—è¡¨
model: sonnet|opus|haiku     â† ä½¿ç”¨çš„æ¨¡å‹
---

System prompt content...     â† Agent çš„ç³»ç»Ÿæç¤º
è¯¦ç»†è¯´æ˜è§’è‰²ã€èŒè´£ã€æµç¨‹ç­‰
```

## ğŸš¦ é”™è¯¯å¤„ç†å’Œè¾¹ç•Œæƒ…å†µ

### 1. Agent å¤±è´¥

```
å¦‚æœ Agent æ— æ³•å®Œæˆä»»åŠ¡:
  â†“
DM è¯†åˆ«å¤±è´¥
  â†“
æ ¹æ®å¤±è´¥ç±»å‹:
  â€¢ å¦‚æœæ˜¯ planner: ä½¿ç”¨å‡è®¾ç»§ç»­
  â€¢ å¦‚æœæ˜¯ developer: è®°å½•é—®é¢˜ï¼Œç»§ç»­æµ‹è¯•
  â€¢ å¦‚æœæ˜¯ tester: ä½¿ç”¨æ‰‹åŠ¨æµ‹è¯•
  â€¢ å¦‚æœæ˜¯ debugger: å°è¯•é€šç”¨ä¿®å¤
```

### 2. Hook å¤±è´¥

```
å¦‚æœ Hook è„šæœ¬å‡ºé”™:
  â†“
é”™è¯¯è¢«æ•è·å¹¶è®°å½•åˆ° stderr
  â†“
Hook è¿”å› exit(0) (ä¸å¹²é¢„)
  â†“
å·¥ä½œæµè‡ªç„¶ç»§ç»­ï¼ˆDM è‡ªä¸»å†³ç­–ï¼‰
```

### 3. æœ€å¤§è¿­ä»£æ¬¡æ•°

```
Debug Loop è¾¾åˆ° 5 æ¬¡:
  â†“
workflow_dm.py æ£€æµ‹åˆ° iterations >= 5
  â†“
è¿”å› decision: "continue" (ä¸ block)
  â†“
DM ç”Ÿæˆæœ€ç»ˆæŠ¥å‘Šï¼ˆéƒ¨åˆ†æˆåŠŸï¼‰
  â†“
å»ºè®®äººå·¥ä»‹å…¥
```

### 4. æµ‹è¯•ä¸å­˜åœ¨

```
Tester æ— æ³•æ‰¾åˆ°æµ‹è¯•:
  â†“
æ‰§è¡Œæ‰‹åŠ¨æµ‹è¯•åœºæ™¯
  â†“
æŠ¥å‘ŠçŠ¶æ€: "NO_TESTS"
  â†“
workflow_dm.py æ ¹æ®æ‰‹åŠ¨æµ‹è¯•ç»“æœå†³å®š
  â†“
å¦‚æœæ‰‹åŠ¨æµ‹è¯•é€šè¿‡: å®Œæˆ
å¦‚æœæ‰‹åŠ¨æµ‹è¯•å¤±è´¥: è¿›å…¥ debug loop
```

## ğŸ”¬ å¯æ‰©å±•æ€§

### æ·»åŠ æ–°çš„ Agent

1. **åˆ›å»º Agent é…ç½®**: `.claude/agents/my-agent.md`
2. **å®šä¹‰è§’è‰²å’Œå·¥å…·**: åœ¨ frontmatter ä¸­é…ç½®
3. **ç¼–å†™ç³»ç»Ÿæç¤º**: è¯¦ç»†è¯´æ˜èŒè´£
4. **æ›´æ–° workflow_dm.py**: æ·»åŠ æ–°çš„å†³ç­–åˆ†æ”¯
5. **æ›´æ–° auto-dev.md**: åœ¨å·¥ä½œæµä¸­è°ƒç”¨æ–° agent

### æ·»åŠ æ–°çš„ Hook

1. **åˆ›å»º Hook è„šæœ¬**: `.claude/hooks/my-hook.py`
2. **å®ç°é€»è¾‘**: è¯»å– stdin, åˆ†æ, è¿”å›å†³ç­–
3. **é…ç½®è§¦å‘**: åœ¨ settings.json ä¸­æ·»åŠ 
4. **æµ‹è¯•**: ä½¿ç”¨ echo æ¨¡æ‹Ÿè¾“å…¥è¿›è¡Œæµ‹è¯•

### åˆ›å»ºæ–°çš„å·¥ä½œæµ

1. **åˆ›å»º Command**: `.claude/commands/my-workflow.md`
2. **å®šä¹‰é˜¶æ®µ**: è§„åˆ’ agent è°ƒç”¨é¡ºåº
3. **æ·»åŠ  Hook æ”¯æŒ**: ç¡®ä¿ hooks èƒ½è¯†åˆ«æ–°å·¥ä½œæµ
4. **æµ‹è¯•å’Œè¿­ä»£**: é€æ­¥ä¼˜åŒ–æµç¨‹

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### Token ä¼˜åŒ–

1. **ä¸Šä¸‹æ–‡éš”ç¦»**: æ¯ä¸ª agent ç‹¬ç«‹ä¸Šä¸‹æ–‡
2. **ç²¾ç¡®å·¥å…·æƒé™**: åªç»™å¿…è¦çš„å·¥å…·
3. **æ¨¡å‹é€‰æ‹©**: ç®€å•ä»»åŠ¡ç”¨ haiku
4. **æç¤ºä¼˜åŒ–**: ç²¾ç®€ä½†æ˜ç¡®çš„æŒ‡ä»¤

### é€Ÿåº¦ä¼˜åŒ–

1. **å¹¶è¡ŒåŒ–**: æœªæ¥å¯æ”¯æŒå¹¶è¡Œ agent è°ƒç”¨
2. **ç¼“å­˜**: é‡å¤ä»»åŠ¡å¯ä»¥ç¼“å­˜è®¡åˆ’
3. **å¿«é€Ÿå¤±è´¥**: æ—©æœŸæ£€æµ‹å¹¶æŠ¥å‘Šé—®é¢˜
4. **å¢é‡å®ç°**: åˆ†æ­¥å®ç°è€Œéä¸€æ¬¡å…¨éƒ¨

## ğŸ¯ è®¾è®¡åŸåˆ™

1. **å…³æ³¨ç‚¹åˆ†ç¦»**: æ¯ä¸ªç»„ä»¶æœ‰å•ä¸€èŒè´£
2. **å£°æ˜å¼é…ç½®**: é€šè¿‡ markdown å’Œ JSON é…ç½®
3. **å¯è§‚å¯Ÿæ€§**: å……åˆ†çš„æ—¥å¿—å’ŒçŠ¶æ€æŠ¥å‘Š
4. **ä¼˜é›…é™çº§**: å¤±è´¥æ—¶æœ‰åˆç†çš„å›é€€
5. **äººæœºåä½œ**: æ”¯æŒäººå·¥ä»‹å…¥å’Œæ‰‹åŠ¨æ§åˆ¶

---

è¿™ä¸ªæ¶æ„è®¾è®¡å®ç°äº†é«˜åº¦è‡ªåŠ¨åŒ–çš„åŒæ—¶ä¿æŒäº†çµæ´»æ€§å’Œå¯æ§æ€§ã€‚
